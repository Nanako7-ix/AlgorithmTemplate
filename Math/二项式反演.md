# 二项式反演

## 柿子

### 形式一

$$
f(k) = \sum_{i = 0}^{k} (-1)^i\binom{k}{i} g(i) \Leftrightarrow g(k) = \sum_{i = 0}^{k} (-1)^i\binom{k}{i} f(i)
$$

### 形式二

这个是重点，我们一般可以推导出左边的式子，因为没有 $-1$ 更好推。所以这个用得比较多。

$$
f(k) = \sum_{i = m}^{k} \binom{k}{i} g(i) \Leftrightarrow g(k) = \sum_{i = m}^{k} (-1)^{k - i}\binom{k}{i} f(i)
$$

### 形式三

$$
f(k) = \sum_{i = 0}^{k} \binom{k}{i} g(i) \Leftrightarrow g(k) = \sum_{i = 0}^{k} (-1)^{k - i}\binom{k}{i} f(i)
$$

## 例题

### [bzoj 2839. 集合计数](https://darkbzoj.cc/problem/2839)

我们一般这是式子是这样使用的。$f(k)$ 表示钦定 $k$ 个元素为交集中的元素的方案数，那么 $f(k) = \binom{n}{k} $，$g(k)$ 就是我们要求的答案，也就是交集中元素恰好 $k$ 个的方案数。

什么是钦定？你可以认为是特殊元素。考虑 $f(k)$，我们做的事是：找到若干个集合并且他们的交集大小大于等于 $k$，同时选择交集中 $k$ 个元素把它设置为特殊元素（你可以想想从 $n$ 个小球里面选择若干个小球，并将其中 $k$ 个涂成了黄色）这个方案数是多少呢，其实很容易计算。

我们不妨考虑先选择特殊元素，这个的方案数是 $\binom{n}{k}$，然后再选择集合，包含这 $k$ 个元素的集合个数是 $2^{n-k}$ 个，在这些集合中选择至少一个集合，方案数是 $2^{2^{n-k}} - 1$。

那么我们可以建立这样的关系：

$$
f(k) = \sum_{i=k}^n \binom{i}{k}\cdot g(i)
$$

解释一下为什么这个成立：我们可以枚举我们选择的集合的交集的大小，这个大小是从 $k$ 一直到 $n$ 的，方案数是 $g(i)$，但是这个时候右边和左边还不能等价，因为还没有选择特殊元素。我们从大小为 $i$ 的交集中选择 $k$ 个元素作为特殊元素。这样计算得到的方案数就是和 $f$ 的组合意义是一样的了。

既然上面这条式子成立，我们使用二项式反演的形式三可以得到：

$$
\begin{aligned}
g(k) &= \sum_{i=k}^n (-1)^{i-k}\binom{i}{k} f(i)\\
&= \sum_{i=k}^n (-1)^{i-k}\binom{i}{k}\binom{n}{i}(2^{2^{n-i}} - 1)
\end{aligned}
$$

预处理一下即可 $O(n)$ 求解。
